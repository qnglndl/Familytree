'''
                       _oo0oo_
                      o8888888o
                      88" . "88
                      (| -_- |)
                      0\  =  /0
                    ___/`---'\___
                  .' \\|     |// '.
                 / \\|||  :  |||// \
                / _||||| -:- |||||- \
               |   | \\\  - /// |   |
               | \_|  ''\---/''  |_/ |
               \  .-\__  '-'  ___/-. /
             ___'. .'  /--.--\  `. .'___
          ."" '<  `.___\_<|>_/___.' >' "".
         | | :  `- \`.;`\ _ /`;.`/ - ` : | |
         \  \ `_.   \_ __\ /__ _/   .-` /  /
     =====`-.____`.___ \_____/___.-`___.-'=====
                       `=---='


     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

           ä½›ç¥–ä¿ä½‘     æ°¸ä¸å®•æœº     æ°¸æ— BUG

       ä½›æ›°:  
               å†™å­—æ¥¼é‡Œå†™å­—é—´ï¼Œå†™å­—é—´é‡Œç¨‹åºå‘˜ï¼›  
               ç¨‹åºäººå‘˜å†™ç¨‹åºï¼Œåˆæ‹¿ç¨‹åºæ¢é…’é’±ã€‚  
               é…’é†’åªåœ¨ç½‘ä¸Šåï¼Œé…’é†‰è¿˜æ¥ç½‘ä¸‹çœ ï¼›  
               é…’é†‰é…’é†’æ—¥å¤æ—¥ï¼Œç½‘ä¸Šç½‘ä¸‹å¹´å¤å¹´ã€‚  
               ä½†æ„¿è€æ­»ç”µè„‘é—´ï¼Œä¸æ„¿é èº¬è€æ¿å‰ï¼›  
               å¥”é©°å®é©¬è´µè€…è¶£ï¼Œå…¬äº¤è‡ªè¡Œç¨‹åºå‘˜ã€‚  
               åˆ«äººç¬‘æˆ‘å¿’ç–¯ç™«ï¼Œæˆ‘ç¬‘è‡ªå·±å‘½å¤ªè´±ï¼›  
               ä¸è§æ»¡è¡—æ¼‚äº®å¦¹ï¼Œå“ªä¸ªå½’å¾—ç¨‹åºå‘˜ï¼Ÿ
'''

# -*- coding: utf-8 -*-
"""
æ•°æ®åº“è¿æ¥æµ‹è¯•è„šæœ¬
ç”¨äºæ£€æŸ¥MySQLæ•°æ®åº“è¿æ¥çŠ¶æ€å’Œå‚æ•°æœ‰æ•ˆæ€§
"""

import pymysql
import os
from dotenv import load_dotenv

# åŠ è½½ç¯å¢ƒå˜é‡
load_dotenv()

# è·å–æ•°æ®åº“è¿æ¥å‚æ•°
db_config = {
    'host': os.getenv('DB_HOST'),
    'port': int(os.getenv('DB_PORT')),
    'user': os.getenv('DB_USER'),
    'password': os.getenv('DB_PASSWORD'),
    'db': os.getenv('DB_NAME'),
    'charset': 'utf8mb4'
}

print("=== æ•°æ®åº“è¿æ¥æµ‹è¯• ===")
print("è¿æ¥å‚æ•°:")
for key, value in db_config.items():
    if key == 'password':
        print(f"{key}: {'*' * len(value)}")
    else:
        print(f"{key}: {value}")

print("\nå¼€å§‹æµ‹è¯•è¿æ¥...")

try:
    # å°è¯•è¿æ¥æ•°æ®åº“
    conn = pymysql.connect(**db_config)
    print("âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ!")
    
    # å°è¯•æ‰§è¡Œä¸€ä¸ªç®€å•çš„æŸ¥è¯¢
    with conn.cursor() as cursor:
        cursor.execute("SELECT VERSION()")
        version = cursor.fetchone()
        print(f"ğŸ“Œ MySQLç‰ˆæœ¬: {version[0]}")
    
    # å…³é—­è¿æ¥
    conn.close()
    print("ğŸ”š è¿æ¥å·²å…³é—­")
    
except pymysql.err.OperationalError as e:
    print(f"âŒ è¿æ¥å¤±è´¥: {e}")
    error_code = e.args[0]
    error_msg = e.args[1]
    
    if error_code == 2003:
        print("ğŸ’¡ æç¤º: MySQLæœåŠ¡å™¨å¯èƒ½æœªå¯åŠ¨ï¼Œæˆ–è€…ä¸»æœº/ç«¯å£é…ç½®é”™è¯¯")
    elif error_code == 1044:
        print("ğŸ’¡ æç¤º: æ•°æ®åº“åç§°ä¸å­˜åœ¨æˆ–ç”¨æˆ·æ²¡æœ‰è®¿é—®æƒé™")
    elif error_code == 1045:
        print("ğŸ’¡ æç¤º: ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯")
    else:
        print(f"ğŸ’¡ é”™è¯¯ä»£ç : {error_code}, é”™è¯¯ä¿¡æ¯: {error_msg}")

finally:
    print("\n=== æµ‹è¯•å®Œæˆ ===")
